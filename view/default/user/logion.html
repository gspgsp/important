<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>登录,我的塑料网</title>

	<link rel="stylesheet" type="text/css" href="__CSS__/home/style/commons.css"/>

	<script src="__JS__/home/jquery-1.8.3.min.js" type="text/javascript"></script>


</head>

<body class="member">

<!--member-con begin-->
<div class="member-con">
	<!--mem-inner begin-->
	<div class="mem-inner">
		<div class="memlt"><img src="__IMG__/home/img/memlt.png" width="516" height="380"/></div>
		<!--memrt begin-->
		<div class="memrt">
			<!--opt begin-->
			<div class="opt">
				<!--login begin-->
				<div class="login">
					<form name="" method="post"  id="loginForm"  class="loginform" action="">
						<!--opt-wrap begin-->
						<div class="opt-wrap mobile">
							<div class="icon"></div>
							<input type="text" value="" name="username" placeholder="请输入手机号..."/>
						</div>
						<!--opt-wrap end-->
						<div class="opt-msg"><p></p></div>
						<!--opt-wrap begin-->
						<div class="opt-wrap pwd">
							<div class="icon"></div>
							<input type="password" maxlength="20"  name="password" placeholder="请输入密码..."/>
						</div>
						<!--opt-wrap end-->
						<div class="opt-msg"><p></p></div>
						<!--opt-wrap begin-->
						<div class="opt-wrap code-wrap">
							<input type="text" maxlength="4" name="regcode" placeholder="请输入验证码..."/>
							<div class="code" id="loginCheckCode"></div>
						</div>
						<!--opt-wrap end-->
						<div class="opt-msg"><p></p></div>
						<!--related begin-->
						<div class="related">
							<div class="auto yes"><span></span>下次自动登录</div>
							<div class="forget"><a href="/user/findpwd">忘记密码？</a></div>
						</div>
						<!--related end-->
						<div class="btn">登录</div>
						<p class="qq-login"><a href="/user/login/auth">使用QQ账号登录</a></p>
						<p class="other">还没有账号？去<a href="/user/register">免费注册</a></p>
					</form>
				</div>
			</div>
			<!--opt end-->
		</div>
		<!--memrt end-->
	</div>
	<!--mem-inner end-->

</div>
<!--member-con end-->

{include file="public:footer"}
</body>





<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
<script>
	var tips=$("#tips");
	$(function(){
		createCode(loginCheckCode);
		var login = $(".login"),
				loginMobile = login.find(".mobile input"),

				loginPwd = login.find(".pwd input"),
				loginCode = login.find(".code-wrap input"),
				loginCode2 = login.find(".code"),
				loginSubmit = login.find(".btn"),
				loginAuto = login.find(".related .auto");
		goRegister = login.find(".other a");
		str = "";
		loginSubmit.bind("click",function(){

			//检查手机号码
			if(!checkMobile(loginMobile)){
				return;
			}
			//检查密码
			if(loginPwd.val()==""){
				str = "请输入密码！";
				loginPwd.focus();
				loginPwd.parent().next(".opt-msg").find("p").show().html(str);
				return;
			}
			//检查验证码
			if(!checkCode(loginCode,loginCode2)){
				return;
			}
			$.post('/user/login/dolongin',{username:loginMobile.val(),password:loginPwd.val(),regcode:loginCode.val(),remember:loginAuto.val()},function (data){
				if(data.err>0){
					errMsg(data.msg);
				}else{
					window.location.href="/user";
				}
			},'json');

		});

		function errMsg(msg){
			tips.html(msg);
		}

		//更换验证码
		loginCode2.bind("click",function(){
			createCode($(this));
		});

		//自动登录
		loginAuto.bind("click",function(){
			if($(this).hasClass("yes")){
				$(this).removeClass("yes").addClass("no");
			}
			else{
				$(this).removeClass("no").addClass("yes");
			}
		});


		//检查手机号
		function checkMobile(elem){
			var regEx = /^1[3|4|5|7|8][0-9]\d{4,8}$/;
			if(elem.val()==""){
				str = "请输入手机号！";
				elem.focus();
				elem.parent().next(".opt-msg").find("p").show().html(str);
				return false;
			}
			else if(!regEx.test(elem.val())){
				str = "您输入的手机号格式不对";
				elem.focus();
				elem.parent().next(".opt-msg").find("p").show().html(str);
				return false;
			}
			else{
				elem.parent().next(".opt-msg").find("p").hide().html("");
				return true;
			}
		}


		//检查验证码
		function checkCode(elem,elem2){
			//验证码
			if(elem.val()==""){
				str = "请输入验证码！";
				elem.focus();
				elem.parent().next(".opt-msg").find("p").show().html(str);
				return false;
			}
			else if(elem.val().length>0 && elem.val().length<4){
				str = "验证码是4位！";
				elem.focus();
				elem.parent().next(".opt-msg").find("p").show().html(str);
				return false;
			}
			else if($.trim(elem.val().toUpperCase())!= $.trim(elem2.html())){
				str = "输入的验证码有误！";
				elem.focus();
				elem.parent().next(".opt-msg").find("p").show().html(str);
				return false;
			}
			else{
				elem.parent().next(".opt-msg").find("p").hide().html("");
				return true;
			}
		}




		//生成验证码
		var code ; //在全局 定义验证码
		function createCode(elem){
			code = "";
			var codeLength = 4;//验证码的长度
			var checkCode = $(elem);
			var selectChar = new Array(1,2,3,4,5,6,7,8,9,'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z');//所有候选组成验证码的字符，当然也可以用中文的

			for(var i=0;i<codeLength;i++){
				var charIndex = Math.floor(Math.random()*34);
				code +=selectChar[charIndex];
			}
			if(checkCode){
				checkCode.html(code);
			}
		}

	});
</script>
</html>
