{layout file="public:main_layout"}
{insert_css files='home/user.css'}
{insert_js files='home/tab.js'}
{insert_js files='home/jquery.ajaxupload.js'}
<style type="text/css">
	.requires{border:1px solid red !important;}
	.import.import3{border:1px solid #d6d7dc;
		resize: none;
		width: 400px;
		height:154px;
	}
</style>


<div class="buy-crumb w1220">首页-<a href="/user">个人中心</a></div>
<div class="user-wrap w1220">
    {include file="public:user_left"}
    <div class="right frt">
    	<h3>个人中心-账户信息</h3>
        <!--set1 begin-->
        <div class="set1 color3">
        	<!--tabx begin-->
            <ul class="tabx">
            <li id="tabx1" onmouseover="setTab('tabx',1,2)" class="hover" style="border-left:1px solid #e6e7ea;"><p>个人信息</p><span></span></li>
            <li id="tabx2" onmouseover="setTab('tabx',2,2)"><p>公司信息</p><span></span></li>
            </ul>
            <!--tabx end-->
            <!--con-tabx-1 begin-->
            <div id="con-tabx-1" class="con-tabx" style="width:750px;">
            	<form id="infoForm">
					<!--lt-rt begin-->
					<div class="lt-rt">
					    <!--lt begin-->
					    <div class="lt flt" style="width:750px;">
						    <div style="float:right">
							    <input type="button" value="修改" class="change" style="cursor: pointer;height:40px;width:100px;font-size:14px;border-radius:2px;background:#267bd3;color:#fff;"/>
							    <input type="submit" value="保存" class="save" style="display: none;cursor: pointer;height:40px;width:100px;font-size:14px;border-radius:2px;background:#267bd3;color:#fff;"/>
							</div>
							<div style="clear:both"></div>
					        <table>
					            <tr>
					                <td class="name">我的登录名：</td>
					                <td class="val">{$user_info.mobile}</td>
					            </tr>
					            <tr>
					                <td class="name">我的姓名：</td>
					                <td class="val"><input type="text" value="{$user_info.name}" name="name" class="import" readonly="true"/></td>
					            </tr>
					            <tr>
					                <td class="name">我的头像：</td>
					                <td class="val">
					                    <!--portrait-wrap begin-->
					                    <div class="portrait-wrap">
					                        <div class="portrait flt">
												{if $user_info.thumb}
												<img src="__UPLOAD__/{$user_info.thumb}" id="head" width="80" height="80"/>
												{else}
												<img src="__IMG__/home/logos.jpg"  width="80" height="80"/>
												{/if}
					                        </div>
					                        <div class="upload frt">
					                            <img src="__IMG__/home/portraitUpload.png" width="59" height="68"/>
					                            <input id="permitP_btn" type="file"/>
					                            <input type="hidden" id="url" name="thumb" value="">
					                        </div>
					                    </div>
					                    <!--portrait-wrap end-->
					                </td>
					            </tr>
					            <!-- <tr>
					                <td class="name">我的等级：</td>
					                <td class="val">普通会员</td>
					            </tr> -->
					            <tr>
					                <td class="name">我的积分：</td>
					                <td class="val">{$user_info.points}</td>
					            </tr>
					            <tr>
					                <td class="name">我的业务员：</td>
					                <td class="val">{$user_info.ad_name}</td>
					            </tr>
					            <tr>
					                <td class="name">联系电话：</td>
					                <!-- <td class="val"><input type="text" name="tel" value="{$user_info.tel}" class="import edit" readonly="true"/></td> -->
					                <td class="val"><input type="text" name="tel" value="{$user_info.tel}" class="import  edit" readonly="true"/></td>
					            </tr>
					            <tr>
					                <td class="name">邮箱：</td>
					                <!-- <td class="val"><input type="text" name="email" value="{$user_info.email}" class="import" readonly="true"/></td> -->
					                <td class="val"><input type="text" name="email" value="{$user_info.email}" class="import edit" readonly="true"/></td>
					            </tr>
					            <tr>
					                <td class="name">传真：</td>
					                <!-- <td class="val"><input type="text" name="fax" value="{$user_info.fax}" class="import" readonly="true"/></td> -->
					                <td class="val"><input type="text" name="fax" value="{$user_info.fax}" class="import edit" readonly="true"/></td>
					            </tr>
					        </table>
					    </div>
					    <!--lt end-->
					    <!--rt begin-->
					   <!--  <div class="rt frt">
					        <ul>
					            <li class="bind1"><p></p><span>绑定QQ账号</span></li>
					            <li class="bind2"><p></p><span>绑定微信账号</span></li>
					        </ul>
					    </div> -->
					    <!--rt end-->
					</div>
					<!--lt-rt end-->
					<!-- <div class="opt">
					    <input type="button" value="修改" class="btn1 change"/>
					    <input type="submit" value="保存" class="btn1 save"/>
					</div> -->
            	</form>
            </div>
            <!--con-tabx-1 end-->
            <!--con-tabx-2 begin-->
            <div id="con-tabx-2" class="con-tabx" style="display:none;width:750px;">
            	<form id="companyForm">
            		<div style="float:right">
					    <input type="button" value="修改" class="change2" style="cursor: pointer;height:40px;width:100px;font-size:14px;border-radius:2px;background:#267bd3;color:#fff;"/>
					    <input type="submit" value="保存" id="save2" class="save2" style="display: none;cursor: pointer;height:40px;width:100px;font-size:14px;border-radius:2px;background:#267bd3;color:#fff;"/>
   					    <input type="button" id="bind_member" value="绑定东方付通" style="cursor: pointer;height:40px;width:100px;font-size:14px;border-radius:2px;background:#267bd3;color:#fff;"/>
					</div>
					<div style="clear:both"></div>
	            	<table>
	                	<tr>

	                    	<td class="name">公司名称：</td>
	                        <td><input type="text" name="c_name" style="width:386px;" class="import import1 required" value="{$customer.c_name}" readonly="true"/></td>
	                    </tr>
	                    <tr>
	                    	<td class="name">所需牌号：</td>
	                        <td><input type="text" name="need_product" style="width:386px;" class="import import2 required edit" value="{$customer.need_product}" readonly="true"/></td>
	                    </tr>
	                    <tr>
	                    	<td class="name">公司地址：</td>
	                        <td>
	                            <input type='hidden' name='origin' id='origin' value='{$origin_hidden}' />
	                        	<select style="height:32px;width:197px;" id="origin_0" name="origin_0" onChange="getarea(this)" class="required" disabled="disabled">
	                        		<option value="">请选择</option>
	                        		{foreach from=$area item=value}
	                        		<option {if $value.id==$origin[0]}selected{/if} value="{$value.id}">{$value.name}</option>
	                        		{/foreach}
	                        	</select>
	                        	<select style="height:32px;width:197px;" id="origin_1" name="origin_1" class="required" disabled="disabled">
	                        		<option value="">请选择</option>
	                        		{foreach from=$city item=value}
	                        		<option {if $value.id==$origin[1]}selected{/if} value="{$value.id}">{$value.name}</option>
	                        		{/foreach}
	                        	</select>
	                        </td>
	                    </tr>
	                    <tr>
	                    	<td class="name">详细地址：</td>
	                        <td><input type="text" name="address" class="import import3 required edit" value="{$customer.address}" readonly="true"/></td>
	                    </tr>
	                    <tr>
	                    	<td class="name">邮编：</td>
	                        <td><input type="text" name="zip" class="import import3 edit" value="{$customer.zip}" readonly="true"/></td>
	                    </tr>
	                    <tr>
	                    	<td class="name">公司介绍：</td>
	                        <td><textarea name="com_intro" class="import import3 edit" placeholder="最多能输入250个字" value="{$customer.com_intro}" readonly="true"/></textarea></td>

	                    </tr>
	                </table>
	                <!-- <div class="opt">
	                    <input type="button" value="修改" class="btn1 change2"/>
					    <input type="submit" value="保存" class="btn1 save2"/>
	                </div> -->
                </form>
            </div>
            <!--con-tabx-2 end-->
        </div>
        <!--set1 end--> 
    </div>
</div>

<script type="text/javascript">
function getarea(that){
	var pid=$(that).val();
    var index =layer.load('正在查询请稍后', 0);
	$.get('/api/region',{region_id:pid},function(data){
       	layer.close(index);
		if(data.length){
			//console.log(data);
			var html='<option value="">请选择</option>';
			$(data).each(function(k,v){
				html+='<option value="'+v.id+'">'+v.name+'</option>';
			});
			$(that).nextAll('select').html('<option value="">请选择</option>');
			$(that).next('select').html(html);
		}else{
			$(that).nextAll('select').html('<option value="">请选择</option>');
		}
	},'json');
}
$(function(){
	new AjaxUpload('#permitP_btn', {
	    action: '/public/sysUpload/images?model=1',
	    name: 'image',
	    onSubmit: function(file, suffix) {
	    	// 'gif','jpg','jpeg','png','swf'
	        var patrn = /^(jpg|jpeg|png)$/i;
	        if (!patrn.test(suffix)) {
	        	layer.msg('不支持上传 *.' + suffix + '格式的文件。');
	            return false;
	        }
	    },
	    onComplete: function(file, response) {
	        var result = jQuery.parseJSON(response);
	        if(result.err == 0) {
	            $('#url').val(result.msg);
	            $("#head").attr('src',"__UPLOAD__/"+result.msg);
	        } else {
	        	layer.msg(result.msg);
	        }
	    }
	});


	$("#infoForm").bind('submit', function(){
		var name=$("#infoForm input[name='name']").val().trim();
		if(name.length==0){
			layer.tips('姓名不能为空', $("#infoForm input[name='name']"), {
				  tips: 1
			});
			return false;
		}
		$(".xubox_layer").remove();
	    var index =layer.load('正在处理请稍后', 0);
		var data=$(this).serialize();
		$.post('/user/myset/edit_info',data,function (data){
           	layer.close(index);
			if(data.err==0){
				layer.msg('修改成功');
			}else{
				layer.msg(data.msg);
				window.location.reload();
			}
		},'json');
		return false;
	});

	$("#companyForm").submit(function(){
		var flag=true;
		$(this).find('.required').each(function(k,v){
			if($(this).val().trim().length==0){
				$(this).addClass('requires');
				layer.tips('请填写', $(this), {
					  tips: 1
				});
				flag=false;
				return false;
			}
		});
		if(!flag) return false;
		if(($("#origin_0").val()=="")||($("#origin_1").val()=="")){
			alert('请填写公司地址信息!');
			return false;
		}
		$(".xubox_layer").remove();
	    var index =layer.load('正在处理请稍后', 0);
		$("#origin").val($("#origin_0").val()+'|'+$("#origin_1").val());
		var data=$(this).serialize();
		$.post('/user/myset/edit_company',data,function (data){
           	layer.close(index);
			if(data.err==0){
				//alert('修改成功');
				layer.msg('修改成功');
			}else{
				layer.msg(data.msg);
			}
		},'json');
		return false;
	});


	$("form input,select").live('focus',function(){
		$(this).removeClass('requires');
	});

	var conTabx1 = $("#con-tabx-1");
	$(".change").live("click",function(){
		conTabx1.find(".edit").removeAttr("readonly");
		conTabx1.find(".save").show();
		$(this).hide();
	});

	$(".save").live("click",function(){
		var name=$("#infoForm input[name='name']").val().trim();
		if(name.length==0){
			layer.tips('姓名不能为空', $("#infoForm input[name='name']"), {
				  tips: 1
			});
			return false;
		}else{
			conTabx1.find(".edit").attr("readonly","true");
			conTabx1.find(".change").show();
			$(this).hide();
		}
	});

	var conTabx2 = $("#con-tabx-2");
	$(".change2").live("click",function(){
		conTabx2.find(".edit").removeAttr("readonly");
		conTabx2.find(".save2").show();
		$(this).hide();

		//select可以使用
		conTabx2.find("select").removeAttr("disabled");
	});

	$(".save2").live("click",function(){
		var flag=true;
		$("#companyForm").find('.required').each(function(k,v){
			if($(this).val().trim().length==0){
				$(this).addClass('requires');
				layer.tips('请填写', $(this), {
					  tips: 1
				});
				flag=false;
				return false;
			}
		});
		if(!flag) return false;
		conTabx2.find(".edit").attr("readonly","true");
		conTabx2.find(".change2").show();
		$(this).hide();

		//select禁止使用
		conTabx2.find("select").attr("disabled","disabled");
	});
	
	//绑定东方付通会员账号
	$("#bind_member").click(function(){
		if($("#save2").css('display')!="none"){
			layer.tips('请先保存公司信息!', $("#save2"), {
				  tips: 1
			});
			return false;
		}
		var data=$("#companyForm").serialize();
		$.post('/user/myset/bind_member',data,function (data){
			if(data.err==0){
				layer.msg('操作成功');
			}else{
				layer.msg(data.msg);
			}
		},'json');
	});

})
</script>