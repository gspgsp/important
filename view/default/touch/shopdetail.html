<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link href="__CSS__/wx/normalize.css" rel="stylesheet">
    <link href="__CSS__/wx/layer.css" rel="stylesheet">
    <link href="__CSS__/wx/app.css" rel="stylesheet">
    <script src="__JS__/wx/jquery-2.2.3.min.js" type="text/javascript"></script>
    <script src="__JS__/wx/layer.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {

            function getUrlParam(name) {
                var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
                var r = window.location.search.substr(1).match(reg);  //匹配目标参数
                if (r!=null) return unescape(r[2]); return null; //返回参数值
            }

            var proId=getUrlParam("id");

            $.ajax({
                type:"post",
                url:"/touch/creditshop/get_shopDetail",
                data:{
                    gid:proId
                },
                dataType:'json',
                beforeSend:function () {
                    layer.open({
                        content: '加载中…'
                    });
                },
                success:function (res) {
                    layer.closeAll();
                    console.log(">>>",res);
                    $("#thumbImg").attr("src",res.thumb);
                    $("#proImg").attr("src",res.image);
                    $("#name").text(res.name);
                    $("#proPoints").text(res.points);
                    $("#proPoints2").text(res.points);
                },
                error:function (res) {
                    layer.open({
                        content: '系统错误',
                        time:2
                    });
                }
            });

            $(".proChoose span").on("click",function () {
                var index=$(this).index();
                $(this).addClass("on").siblings("span").removeClass("on");
                $(".proContent").eq(index).show().siblings(".proContent").hide();
            });

            $(".cancel").on("click",function () {
                $(".proLayer").hide();
                $(".layer").hide();
            });

            $(".cancel2").on("click",function () {
                $(".proInput").hide();
                $(".layer").hide();
            });

            $(".confirm").on("click",function () {
                $(".proLayer").hide();
                $(".proInput").show();
            });

            $(".confirm2").on("click",function () {
                var receiver=$("#receiver").val();
                var phone=$("#phone").val();
                var address=$("#address").val();
                var code=123;

                $.ajax({
                    type:"post",
                    url:"/touch/sign/addOrder",
                    data:{
                        gid:proId,
                        receiver:receiver,
                        phone:phone,
                        address:address,
                        code:code
                    },
                    dataType:'json',
                    beforeSend:function () {
                        layer.open({
                            content: '加载中…'
                        });
                    },
                    success:function (res) {
                        layer.closeAll();
                        if(res.err==0){
                            layer.open({
                                content: res.msg,
                                btn: ['确定'],
                                style: 'width:300px',
                                yes:function () {
                                    window.location.reload();
                                }
                            });
                        }else{
                            layer.open({
                                content: res.msg,
                                btn: ['确定'],
                                style: 'width:300px'
                            });
                        }
                        console.log(">>>",res);
                    },
                    error:function (res) {
                        layer.open({
                            content: '系统错误',
                            time:2
                        });
                    }
                });
            });

            $(".proExchange").on("click",function () {
                $(".proLayer").show();
                $(".layer").show();
            });

        })
    </script>
</head>
<body style="padding-bottom: 50px;">
<div class="proDetail">
    <img id="thumbImg">
    <h3 class="proTitle"><span id="name"></span><span id="proPoints"></span>积分</h3>
    <div class="proChoose">
        <span class="on">商品详情</span>
        <span>退换货规定</span>
    </div>
</div>
<div class="proContent proPic">
    <img id="proImg">
</div>
<div class="proContent proTxt" style="display: none;">
    <p>兑换商品若出现以下情况，我的塑料网允许退换货：</p>
    <p>1）商品本身有质量问题，影响使用</p>
    <p>2）兑换的商品在运输过程中出现损毁</p>
    <p>用户可在签收后7日内拨打我的塑料网客服热线400-6129-965，</p>
    <p>申请退换货，退回时，请务必将原包装、内附赠品及说明书和相关文件一并寄回。</p>
    <br>
    <p>若出现以下情况，我的塑料网有权不予进行商品退换货：</p>
    <p>1)非我的塑料网积分商城的兑换商品</p>
    <p>2)不正常使用商品造成的质量问题</p>
    <p>3)超过我的塑料网积分商城承诺的7天退换货有效时间</p>
    <p>4)将商品存储、暴露在不适宜环境中造成的损坏</p>
    <p>5)因未经授权的修理、改动、不正确的安装造成损坏</p>
    <p>6)不可抗力导致礼品损坏</p>
    <p>7)商品的正常磨损</p>
    <p>8)在退换货之前未与我的塑料网客服取得联系，进行过退换货登记</p>
    <p>9)退回商品包装或其他附属物不完整或有毁损</p>
    <br>
    <p>注：商品图片及文字仅供参考，具体以实物为准。</p>
</div>
<div class="proExchange">立即兑换</div>
<div class="proLayer" style="display: none;">
    <h3>温馨提示</h3>
    <p>此次兑换将使用<span id="proPoints2"></span>积分，确定兑换码？</p>
    <p style="text-align: center">
        <button class="cancel">取消</button>
        <button class="confirm">确定</button>
    </p>
</div>
<div class="proInput">
    <p><span>收件人:</span><input id="receiver" class="proText" type="text"></p>
    <p><span>联系电话:</span><input id="phone" class="proText" type="number"></p>
    <p><span>联系地址:</span><input id="address" class="proText" type="text"></p>
    <p><span>验证码:</span><input id="code" class="proText2" type="number"></p>
    <p style="text-align: center">
        <button class="cancel2">取消</button>
        <button class="confirm2">确定</button>
    </p>
</div>
<div class="layer"></div>
</body>
</html>