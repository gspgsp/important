<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>我的塑料网-积分明细</title>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link href="__CSS__/wx/normalize.css" rel="stylesheet">
    <link href="__CSS__/wx/layer.css" rel="stylesheet">
    <link href="__CSS__/wx/app.css" rel="stylesheet">
    <script src="__JS__/wx/jquery-2.2.3.min.js" type="text/javascript"></script>
    <script src="__JS__/wx/layer.js" type="text/javascript"></script>
    <script>
        $(function () {
            var arr1P="";
            var arr2P="";

            function stampToDate(date) {
                var newDate=new Date();
                newDate.setTime(date*1000);
                return newDate.toLocaleString();
            }
            
            function typeName(type) {
                if(type==1){
                    return '签到';
                }else if(type==2){
                    return '登录';
                }else if(type==3){
                    return '发布报价';
                }else if(type==4){
                    return '订单取消积分返还';
                }else if(type==5){
                    return '兑换礼品';
                }else if(type==6){
                    return '发布采购';
                }else if(type==7){
                    return '注册完善信息送';
                }else if(type==8){
                    return 'app注册';
                }else if(type==9){
                    return '资源库发布';
                }else if(type==10){
                    return '资源库搜索';
                }
            }

            $.ajax({
                type:"get",
                url:"/touch/creditdetail/get_creditdetail",
                dataType:'json',
                beforeSend:function () {
                    layer.open({
                        content: '加载中…'
                    });
                },
                success:function (res) {
                    var arr1=[];
                    var arr2=[];
                    layer.closeAll();
                    console.log(">>>",res);
                    $("#points").html(res.points);
                    if(res.err==1){
                        window.location.href="/touch/login";
                    }else{
                        res.detail.forEach(function (v,i,a) {
                           if(v.type==5){
                               arr2.push(a[i]);
                           }else{
                               arr1.push(a[i]);
                           }
                        });
                        arr1.forEach(function (v,i,a) {
                            arr1P+="<p>" +
                                    "<span class='creditSignTime'>"+stampToDate(v.addtime)+"</span>" +
                                    "<br>"+ typeName(v.type) +"<span class='creditIntegral'>+"+v.points+"</span>" +
                                    "</p>";
                        });
                        arr2.forEach(function (v,i,a) {
                            arr2P+="<p>" +
                                    "<span class='creditSignTime'>"+stampToDate(v.addtime)+"</span>" +
                                    "<br>"+ typeName(v.type) +"<span class='creditIntegral2'>"+v.points+"</span>" +
                                    "</p>";
                        });
                        $(".creditSign").html(arr1P);
                        $(".creditSign2").html(arr2P);
                    }
                },
                error:function (res) {
                    console.log(">>>",res);
                }
            });

            $(".sign").on("click",function () {
                $.ajax({
                    type:"get",
                    url:"/touch/sign/signOn",
                    dataType:'json',
                    success:function (res) {
                        layer.open({
                            content: res.msg,
                            time:2
                        });

                    },
                    error:function (res) {
                        layer.open({
                            content: '系统错误',
                            time:2
                        });
                    }
                });
            });
        })
    </script>
</head>
<body>
<div class="creditDeatil">
    <h3 class="creditDeatilHead">
        <span id="points"></span>&nbsp;积分
    </h3>
    <div class="creditDeatilNav">
        <span class="sign">签到</span>
        <span>
            <a href="/touch/creditshop">兑换</a>
        </span>
    </div>
</div>
<div class="creditDeatilTitle">
    积分收支明细
</div>
<div class="creditSign"></div>
<div class="creditSign2"></div>
</body>
</html>