{layout file="public:mini_layout"}
<div class="mini-toolbar" style="margin:3px 3px 0;">
	<table style="width:100%;">
		<tr>
			<td style="white-space:nowrap;">
				<a class="mini-button" iconCls="icon-add" plain="true" onclick="add()">新增</a>
				<span class="separator"></span>
				<a class="mini-button" iconCls="icon-save" onclick="saveData()" plain="true">保存</a>
			</td>
			<td style="float:right;">
			<form id="soform">
				起止时间
            	<input name="startTime" class="mini-datepicker" style="width:100px;"/> -
            	<input name="endTime" class="mini-datepicker" style="width:100px;"/>

            	<select name="status" id="soStatus">
                	<option value="" selected="selected">特定时间</option>
                    <option value="this_week">本周</option>
                    <option value="last_week">上周</option>
                    <option value="this_month">本月</option>
                    <option value="last_month">本月</option>
                </select>

				<!-- <select name="depart">
                    <option value="">=所属部门=</option>
                	{html_options options=$depart}
                </select> -->

				管理员名字
				<input name="keyword" class="mini-textbox" emptyText="请输入关键词" style="width:140px;" onenter="onKeyEnter"/>   
				<a class="mini-button" iconCls="icon-search" onclick="search()">查询</a>
				<span id="searchMsg"></span></form>
			</td>
		</tr>
	</table>
</div>
<div class="mini-fit" style="padding:1px 3px 3px;">
	<div id="gridCell" class="mini-datagrid" style="width:100%;height:100%;"url="/user/report/init?action=grid"  idField="id"
	sizeList="[10,20,50,100]" pageSize="20" multiSelect="true" showFilterRow="true" allowCellSelect="true" allowCellEdit="true">
		<div property="columns">
			<div type="checkcolumn"></div>
			<div field="name" width="40" headerAlign="center" align="center">管理员</div>
			<!-- <div field="depart" width="40" headerAlign="center" align="center">所属部门</div> -->
			<div field="sale_num" width="40" headerAlign="center" align="center"><span style="color:red">*</span>销售吨位
				<input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/>
			</div>
			<div field="sales" width="40" headerAlign="center" align="center"><span style="color:red">*</span>销售金额
				<input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/>
			</div>
			<div field="buy_num" width="40" headerAlign="center" align="center"><span style="color:red">*</span>采购吨位
				<input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/>
			</div>
			<div field="buys" width="40" headerAlign="center" align="center"><span style="color:red">*</span>采购金额
				<input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/>
			</div>
			<div field="old_user" width="40" headerAlign="center" align="center"><span style="color:red">*</span>成交老客户量
				<input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/>
			</div>
			<div field="new_user" width="40" headerAlign="center" align="center"><span style="color:red">*</span>成交新客户量
				<input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/>
			</div>
			<div field="day_call" width="40" headerAlign="center" align="center"><span style="color:red">*</span>日电话量
				<input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/>
			</div>
			<div field="month_call" width="40" headerAlign="center" align="center"><span style="color:red">*</span>月电话量
				<input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/>
			</div>
			<div field="profit" width="40" headerAlign="center"  align="center"><span style="color:red">*</span>合计利润
				<input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/>
			</div>
			<div field="report_date" width="40" headerAlign="center" allowSort="true" align="center">考核月份
				<!-- <input property="editor" class="mini-textbox" style="width:100%;" minHeight="50"/> -->
			</div>
			<div field="update_time" width="40" headerAlign="center" dateFormat="yyyy-MM-dd HH:mm" allowSort="true" align="center">修改时间</div>
			
		</div>
	</div>
</div>

<script src="__JS__/jquery/jquery.upload.js" type="text/javascript"></script>
<script type="text/javascript">
mini.parse();
//搜索或刷新
var grid = mini.get("gridCell");
function search() {
  grid.load($("#soform").serializeObject(),function(e){
	$("#searchMsg").html(e.msg);
  });
}
search();
function onKeyEnter(e) {
  search();
}

function add(){
	var width=300, height=320;
	title="新增绩效考核";
	mini.open({
		url: "/user/report/addreport",
		showMaxButton:true,
		 title: title, width: width, height:height,
		ondestroy: function (action) {
			if(action=='save'){ //重新加载
				grid.reload();
			}
		}
	});		
}

//行内编辑后保存数据
function saveData() {
	var data = grid.getChanges();
	var json = mini.encode(data);
	if(json.length<10) return false;
  
	grid.loading("保存中，请稍后......");
	var callback=function(data){
	grid.unmask();
	if(data.err=='0'){
	  grid.reload();
	}else{
	  alert(data.msg)
	  return false;
	}
  }
	utils.ajax('/user/report/save',{data:json},callback,"POST","json");
}

function GetData() {
	var row = grid.getSelected();
	return row;
}


function CloseWindow(action) {
	if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
	else window.close();
}
//确定并获取数据
function onComfirm() {
	CloseWindow("ok");
}
//取消
function onCancel() {
	CloseWindow("cancel");
}

</script>