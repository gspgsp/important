{layout file="public:mini_layout"}
<div style="padding:5px;">
  <div id="infoForm" class="form">
    <div class="mini-tabs" activeIndex="0" plain="false">
      <div title="基本信息">
        <input class="mini-hidden" name="user_id" value="{$user.user_id}"/>
		    <table width="100%">
          <tr>
            <td>登录账号（手机号码）：</td>
            <td>
              <input name="mobile" class="mini-textbox" style="width:150px;" maxlength="11" required="true" vtype="mobile" onvalidation="onValidMobile" value="{$user.mobile}"/>
            </td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr>
            <td>登录密码：</td>
            <td><input name="password" class="mini-textbox" style="width:150px;" value="" {if $user.user_id eq ''} vtype="rangeLength:6,20" required="true"{/if}/></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr>
            <td>邮件地址：</td>
            <td><input name="email" class="mini-textbox" style="width:150px;" required="true" vtype="email" value="{$user.email}" requiredErrorText="email输入不正确"/></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>

          <tr>
            <td>公司名称：</td>
            <td><input name="company_name" class="mini-textbox" style="width:250px;" required="true" value="{$user.infoExt.company_name}"/></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
          <tr>
            <td>公司类别：</td>
            <td><input class="mini-combobox" style="width:250px;" name="company_category" data='{:setMiniConfig|$company_category}' required="true" textfield="name" valuefield="id" value="{$user.infoExt.company_category}"/>
            </td>
            <td>公司行业：</td>
            <td><input class="mini-combobox" name="company_industry" data='{:setMiniConfig|$company_industry}' required="true" textfield="name" valuefield="id" value="{$user.infoExt.company_industry}"/>
            </td>
          </tr>
          <tr>
            <td>公司规模：</td>
            <td><input class="mini-combobox" name="company_scale" data='{:setMiniConfig|$company_scale}' required="true" textfield="name" valuefield="id" value="{$user.infoExt.company_scale}"/>
            </td>
            <td>月销售收入：</td>
            <td>
              <input name="company_revenue" class="mini-textbox" style="width:100px;" required="true" onvalidation="onValidFullMoney" value="{$user.infoExt.company_revenue|default:}"/>
            万
            </td>
          </tr>
          <tr>
            <td>经营场所：</td>
            <td><input class="mini-combobox" name="company_palce" data='{:setMiniConfig|$company_palce}' required="true" textfield="name" valuefield="id" value="{$user.infoExt.company_palce}"/>
            </td>
            <td>经营年限：</td>
            <td>
              <input name="company_period" class="mini-textbox" style="width:100px;" required="true" onvalidation="onValidFullMoney" value="{$user.infoExt.company_period|default:}"/>
            年
            </td>
          </tr>
          <tr>
            <td>所在省市</td>
            <td><input name="company_province" id="c_1_0" style="width:80px;" required="true" class="mini-combobox" textField="name" valueField="id" onvaluechanged="setReg('c')" data='{:setMiniConfig|$regionList}' value="{$user.infoExt.company_province}" showNullItem="true"/>
              <input name="company_city" id="c_2_0" required="true" class="mini-combobox" url="{if $user.infoExt.company_province}/user/user/getRegion?pid={$user.infoExt.company_province}{/if}" value="{$user.infoExt.company_city}" style="width:80px;" textField="name" valueField="id" />
            </td>
          </tr>          
          <tr>
            <td>公司地址：</td>
            <td><input name="company_address" class="mini-textbox" style="width:250px;" required="true" value="{$user.infoExt.company_address}"/></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>是否担保人：</td>
            <td><input name="is_security" class="mini-combobox" data='{:setMiniConfig|$is_security}' textfield="name" valuefield="id" value="{$user.info.is_security}"/></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>状态：</td>
            <td><input class="mini-combobox" name="status" style="width:100px;" data='{:setMiniConfig|$status}' textfield="name" valuefield="id" value="{$user.status|default:1}"/></td>
          </tr>
          <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
          </tr>
        </table>
      </div>
    </div><input name="utype" class="mini-textbox" style="display:none" value="3" vtype="utype"/>
    <div align="center" style="margin-top:10px;">
      <a class="mini-button" iconcls="icon-ok" onclick="submitForm">确定</a>
      <a class="mini-button" iconcls="icon-cancel" onclick="onCancel">关闭</a><span id="returnMsg" style="padding-left:5px; color:#F00;"></span>
    </div>
  </div>
</div>
<script src="__JS__/jquery/jquery.upload.js" type="text/javascript"></script>
<script charset="utf-8" src="__JS__/kindeditor/kindeditor.js"></script>
<script charset="utf-8" src="__JS__/kindeditor/lang/zh_CN.js"></script>
<script type="text/javascript">
mini.parse();
var form = new mini.Form("#infoForm");

function submitForm(){
  form.validate();
  if(form.isValid() == false) return;
  
  //提交数据
  var o = form.getData();
  var json = mini.encode(o);
  $("#returnMsg").text('');
  form.loading("数据提交中，请稍后......");
  {if $user.user_id eq ''}
  var urlstr = '/user/user/addSubmit';
  {else}
  var urlstr = '/user/user/editSubmit';
  {/if}
  $.post(urlstr,{data:json},function(data){
	  form.unmask();
	  $("#returnMsg").text(data.msg);
	  if(data.err=='0'){
		  CloseWindow("save");
	  }else{
		  return false;
	  }
  },'json');
}

function CloseWindow(action) {            
	if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
	else window.close();            
}
function onCancel(e) {
	CloseWindow("cancel");
}

function onValidMobile(e){
   if (e.isValid) {
	   if(!utils.isMobile(e.value)){
		   e.errorText = "错误的手机号";
		    e.isValid = false;
	   }
   }
}
function onValidZip(e){
   if (e.isValid) {
	   if(!utils.isZip(e.value)){
		   e.errorText = "错误的邮编";
		    e.isValid = false;
	   }
   }
}
function setReg(name,val){
  var deptCombo = mini.get(name+"_1_0");
  var positionCombo = mini.get(name+"_2_0");
  onDeptChanged(deptCombo,positionCombo,val);
}
function onDeptChanged(deptCombo,positionCombo,val) {
  var id = deptCombo.getValue();

  positionCombo.setValue("");
  var url = "/user/user/getRegion?pid=" + id
  positionCombo.setUrl(url);
  //positionCombo.select(0);
}
</script>
