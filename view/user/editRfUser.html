{layout file="public:mini_layout"}
<div style="padding:5px;">
  <div id="basicForm" class="form">
    <input class="mini-hidden" name="user_id" value="{$user.user_id}"/>
    <table border="0" cellpadding="1" cellspacing="2">
      <tr>
        <td style="width:80px;">手机：</td>
        <td style="width:210px;">{$user.mobile}</td>
      </tr>
      <tr>
        <td>推荐人：</td>
        <td><input name="ref_uid" class="mini-buttonedit" onbuttonclick="usrChoose" allowInput="false" text="{$user.info.ref_uid}" required="true" style="width:150px" id="usrId"/></td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td><a class="mini-button" iconCls="icon-ok" onclick="submitBasic">确定</a> <a class="mini-button" iconCls="icon-cancel" onclick="onCancel">关闭</a> <span id="returnMsg" style="padding-left:5px; color:#F00;"></span></td>
      </tr>
    </table>
  </div>
</div>
<script type="text/javascript">
mini.parse();

function usrChoose(e){
	var btn = this;
    mini.open({
		url: "/user/user/soso",
		title: "选择会员",
		width: 960,
		height: 450,
		ondestroy: function (action) {
			if (action == "ok") {
				var iframe = this.getIFrameEl();
				var data = iframe.contentWindow.GetData();
				data = mini.clone(data);    //必须
				if (data) {
					btn.setValue(data.user_id);
					btn.setText(data.user_id);
					$("#"+btn.id+"\\$value").val(data.user_id);
					//$("input[name=info\\[user_id\\]]").val(data.user_id);
				}
			}
		}
	});         
}

var form = new mini.Form("#basicForm");
function submitBasic(){
  form.validate();
  if(form.isValid() == false) return;
  
  //提交数据
  var o = form.getData();
  var json = mini.encode(o);
  $("#returnMsg").text('');
  form.loading("数据提交中，请稍后......");
  $.post('/user/user/editSubmit?base=yes',{data:json},function(data){
	  form.unmask();
	  $("#returnMsg").text(data.msg);
	  if(data.err=='0'){
		  CloseWindow("save");
	  }else{
		  return false;
	  }
  },'json');
}

function CloseWindow(action) {            
	if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
	else window.close();            
}
function onCancel(e) {
	CloseWindow("cancel");
}

</script> 
