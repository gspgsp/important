{layout file="public:mini_layout"}
<div style="padding:5px;">
	<div id="infoForm" class="form">
		<!-- <div class="mini-tabs" activeIndex="0" plain="false"> -->
			<div>
				<input class="mini-hidden" name="stype" value="0"/>
				<input class="mini-hidden" name="c_id" value="{$usermodel.c_id}"/>
				<input class="mini-hidden" name="nc_id" value="{$usermodel.c_id}"/>
				<input class="mini-hidden" name="info_user_id" value="{$usermodel.user_id}"/>
				<input class="mini-hidden" name="chtype" value="{$chtype}"/>
				<input class="mini-hidden" name="isEdit" value="{$isEdit}"/>
				<table width="100%">
					<caption><strong>------------------------------------------------会员信息------------------------------------------------</strong></caption>
					<tr>
					  <!-- <td>归属公司：</td>
					  <td>
						<input name="c_id" class="mini-buttonedit" onbuttonclick="usrChoose" value="{$usermodel.c_id}" allowInput="false"  text="{$c_name}"  style="width:170px" id="usrId"/>
					  </td> -->
					  <td ></td>
					  <td></td>
				  	</tr>
					  <tr>
						<td >姓名：</td>
						<td><input name="name" class="mini-textbox" style="width:150px;" required="true" vtype="rangeLength:2,30" value="{$usermodel.con_name}"/></td>
						<td>性别：</td>
						<td><input class="mini-combobox" name="sex" style="width:100px;" data='{:setMiniConfig|$sex}' required="true" textField="name" valueField="id" value="{$usermodel.sex}"/></td>
					  </tr>
					  <tr>
						<td style="width:80px;">手机：</td>
						<td style="width:210px;"><input name="mobile" class="mini-textbox" maxlength="11"  style="width:150px;" required="true" onvalidation="onValidMobile" value="{$usermodel.mobile}"/></td>
						<td>电话：</td>
						<td><input name="tel" class="mini-textbox" style="width:150px;" vtype="rangeLength:6,14" value="{$usermodel.tel}"/></td>
					  </tr>
					  <tr>
						<td style="width:80px;">QQ号：</td>
						<td style="width:210px;"><input name="qq" class="mini-textbox" maxlength="12"  style="width:150px;" value="{$usermodel.qq}"/></td>
						<td>传真：</td>
						<td><input name="fax" class="mini-textbox" style="width:150px;" vtype="rangeLength:6,14" value="{$usermodel.fax}"/></td>
					  </tr>
					  <tr>
						<td>邮件：</td>
						<td><input name="email" class="mini-textbox" style="width:150px;"   value="{$usermodel.email}"/></td>
						<td></td>
						<td></td>
					  </tr>
					  <tr>
						<td>备注：</td>
						<td colspan="3">
						  <input name="remark" class="mini-textarea" style="width:403px; height:50px;" value="{$usermodel.remarks}"/>
						</td>
					  </tr>
					  <tr>
						<td>状态：</td>
						<td><input class="mini-combobox" name="status" style="width:100px;" data='{:setMiniConfig|$status}' required="true" textField="name" valueField="id" value="{$usermodel.status}"/></td>
					  </tr>
				</table>
				<table width="100%">
					<caption><strong>------------------------------------------------客户信息------------------------------------------------</strong></caption>
					<tr>
						<td width="82px;">归属公司：</td>
						<td>
							<input name="c_name" id="c_name" class="mini-textbox" style="width:300px;" required="true" vtype="rangeLength:2,50" value="{$usermodel.c_name}"/><a class="mini-button" onclick="checkCompany">核查</a>
						</td>
						<td ></td>
						<td></td>
					</tr>
					<tr>
						<td width="82px;">主营产品：</td>
						<td><input name="main_product" class="mini-textbox" style="width:300px;" required="false" value="{$usermodel.main_product}"/></td>
					</tr>
					<tr>
						<td width="82px;">关注牌号：</td>
						<td id="td">
							<input id="tbl1" class="mini-textboxlist" name="" textName="model_1" required="false" style="width:250px;" url="/user/plastic/getModel" value="" text="" valueField="id" textField="model" emptyText ="提示1：牌号一" />（提示：关注牌号最多可选3个）
						</td>
					</tr>

					<tr>
						<td width="82px;">月用量：</td>
						<td><input name="month_consum" class="mini-textbox" style="width:300px;" required="false" value="{$usermodel.month_consum}"/></td>
					</tr>
					<!-- <tr>
						<td >备注：</td>
						<td><input name="remarks" class="mini-textbox" style="width:300px;" required="false" value=""/></td>
					</tr> -->
					<tr>
						<td width="82px;">客户类型：<span style="color: red">*</span></td>
						<td>
						 	<input name="cus_type" class="mini-radiobuttonlist" style="width: 400px;padding-left: 60px;" required="true"  data="[{id: 1, text: '塑料制品企业'}, {id: 2, text: '原料供应商'},{id: 4, text: '服务商'},{id: 5, text: '金融公司'},{id: 6, text: '塑化电商'},{id: 7, text: '回料(含新材料)'},{id: 8, text: '期货'},{id: 9, text: '塑机'},{id: 10, text: '其他'}]" value="{$usermodel.type}"/>
						</td>
					</tr>
				</table>
			</div>
	<!-- </div> -->
	{if $isEdit == 1}
		<div align="center" style="margin-top:10px;">
			<a class="mini-button" iconCls="icon-ok" onclick="submitForm">初审通过</a>
			<a class="mini-button" iconCls="icon-no" onclick="submitForm_1">初审拒绝</a>
			<a class="mini-button" iconCls="icon-cancel" onclick="onCancel">关闭</a>
			<span id="returnMsg" style="padding-left:5px; color:#F00;"></span>
		</div>
	{else}
		<div align="center" style="margin-top:10px;">
			<a class="mini-button" iconcls="icon-ok" onclick="submitForm">确定</a>
			<a class="mini-button" iconcls="icon-cancel" onclick="onCancel">关闭</a>
			<span id="returnMsg" style="padding-left:5px; color:#F00;"></span>
		</div>
	{/if}
	</div>
</div>
<script src="__JS__/jquery/jquery.upload.js" type="text/javascript"></script>
<script charset="utf-8" src="__JS__/kindeditor/kindeditor.js"></script>
<script charset="utf-8" src="__JS__/kindeditor/lang/zh_CN.js"></script>
<script type="text/javascript">
mini.parse();
var form = new mini.Form("#infoForm");

function submitForm(){
	// form.validate();
	// if(form.isValid() == false) return;
	//提交数据
	var o = form.getData();
	var json = mini.encode(o);
	$("#returnMsg").text('');
	form.loading("数据提交中，请稍后......");
	$.post('/user/plastic/savePlasticData',{data:json},function(res){
		form.unmask();
		$("#returnMsg").text(res.msg);
		if(res.err == 0){
			CloseWindow("save");
		}else{
			alert(res.msg);
			return false;
		}
	},'json');
}

//初审拒绝
function submitForm_1(){
    //提交数据
    form.loading("数据提交中，请稍后......");
	var is_trial=3,user_id = $('input[name="info_user_id"]').val();
    $.post('/user/plastic/rejectContact',{user_id:user_id, is_trial:is_trial},function(res){
        form.unmask();
        if(res.err== 0){
            CloseWindow("save");
        }else{
            return false;
        }
    },'json');

}
function CloseWindow(action) {
	if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
	else window.close();
}
function onCancel(e) {
	CloseWindow("cancel");
}

//核查公司
function checkCompany(){
	var c_name = $('input[name="c_name"]').val(), user_id = parseInt($('input[name="info_user_id"]').val(),10);
	$.post('/user/plastic/checkCompany',{c_name:c_name,user_id:user_id},function(res){
		if(res.err == 0){
			var cids = res.cids;
			mini.open({
				url: "/user/plastic/getCompanys?cids="+cids,
				title: "核查公司",
				width: 1200,
				height: 550,
				ondestroy: function (action) {
					if (action == "ok") {
						var iframe = this.getIFrameEl();
						var data = iframe.contentWindow.GetData();
						data = mini.clone(data);    //必须
						if (data) {
							$('input[name="c_name"]').val(data.c_name);
							$('input[name="nc_id"').val(data.c_id);
							$('input[name="stype"]').val(0);
						}
					}
				}
			});
		}else{
			$('input[name="stype"]').val(1);
			alert('未查到公司，可以新增');
		}
	},'json');
}

</script>
