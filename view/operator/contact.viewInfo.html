{layout file="public:mini_layout"}
<style type="text/css">
	.hidden {display:none;}
</style>
<div style="padding:5px;">
	<div id="infoForm" class="form">
		<div class="mini-tabs" activeIndex="0" plain="false">
			<div title="联系人基本信息">
				<div style="height:385px">
					<table border="0" cellpadding="1" cellspacing="2">
						<tr>
							<td>供应商名称：</td>
							<td>哈哈哈</td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td >姓名：<font style="color:red;">*</font></td>
							<td><input name="contact_name" class="mini-textbox" style="width:150px;" required="true" value="6666" vtype="rangeLength:2,30"/></td>
							<td>性别：<font style="color:red;">*</font></td>
							<td><input class="mini-combobox" name="sex" style="width:100px;" data='{:setMiniConfig|$sex}' required="true" textField="name" valueField="id" value=""/></td>
						</tr>
						<tr>
							<td style="width:80px;">联系人手机：<font style="color:red;">*</font></td>
							<td style="width:210px;"><input name="mobile_tel" class="mini-textbox" maxlength="11" value="" style="width:150px;" onvalidation="onValidMobile"/></td>
							<td>联系人固定电话：<font style="color:red;">*</font></td>
							<td><input name="contact_tel" class="mini-textbox" style="width:150px;"  vtype="rangeLength:6,14"/></td>
						</tr>
						<tr>
							<td style="width:80px;">QQ号：</td>
							<td style="width:210px;"><input name="qq" class="mini-textbox" maxlength="30" value="" style="width:150px;"/></td>
							<td>传真：</td>
							<td><input name="comm_fax" class="mini-textbox" style="width:150px;"  vtype="rangeLength:6,14"/></td>
						</tr>
						<tr>
							<td>邮件：</td>
							<td><input name="comm_email" class="mini-textbox" style="width:150px;"  vtype="email"/></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td>备注：</td>
							<td colspan="3">
								<input name="remark" class="mini-textarea" style="width:403px; height:50px;"/>
							</td>
						</tr>
						<tr>
							<td>状1态：</td>
							<td><input class="mini-combobox" name="supplier_contact_type" style="width:100px;" data='{:setMiniConfig|$supplier_contact_type}' required="true" textField="name" valueField="id" value=""/></td>
						</tr>
					</table>
				</div>
			</div>
		</div><input name="utype" class="mini-textbox" style="display:none" value="" vtype="utype"/>
		<div align="center" style="margin-top:10px;">
			<a class="mini-button" iconcls="icon-ok" onclick="submitForm">确定</a>
			<a class="mini-button" iconcls="icon-cancel" onclick="onCancel">关闭</a><span id="returnMsg" style="padding-left:5px; color:#F00;"></span>
		</div>
	</div>
</div>
<script src="__JS__/jquery/jquery.upload.js" type="text/javascript"></script>
<script charset="utf-8" src="__JS__/kindeditor/kindeditor.js"></script>
<script charset="utf-8" src="__JS__/kindeditor/lang/zh_CN.js"></script>
<script type="text/javascript">
    mini.parse();
    var form = new mini.Form("#infoForm");
    function changeEvent(){
        var val = mini.get('cards').getValue();  //  1:是三证合一   0：非三证合一
        if(val == 1){
            $("#one").removeClass('hidden');
            $(".three").addClass('hidden');
            mini.get('merge_three').setValue('1');
            mini.get('a').setValue('');
            mini.get('b').setValue('');
            mini.get('c').setValue('');
            mini.get('img_url1').setValue('');       // 营业执照
            mini.get('img_url2').setValue('');       // 组织机构代码图片
            mini.get('img_url3').setValue('');       // 税务登记证图片

        }else{
            $(".three").removeClass('hidden');
            $("#one").addClass('hidden');
            mini.get('merge_three').setValue('0');
            mini.get('d').setValue('');
            mini.get('img_url4').setValue('');       // 三证合一照片
            mini.get('img_url4').setValue('');
        }

    }

    function submitForm(){
        form.validate();
        if(form.isValid() == false) return;

        //提交数据
        var o = form.getData();
        var supplier_info = mini.encode(o);
        $("#returnMsg").text('');
        form.loading("数据提交中，请稍后......");
        {if $user.user_id eq ''}                       // user_id 应为 供应商id
        var urlstr = '/operator/supplier/addSubmit';     // 没有供应商 新增走add
        {else}
        var urlstr = '/operator/supplier/editSubmit';      // 供应商id 不为空（）
        {/if}
        $.post(urlstr,{data:supplier_info},function(data){
            form.unmask();
            $("#returnMsg").text(data.msg);
            if(data.err=='0'){
                CloseWindow("save");
            }else{
                return false;
            }
        },'json');
    }
    //上传照片接口
    function fileUpload(id) {
        $.ajaxFileUpload({
                url:'/system/sysUpload/images?model={$action}',
                secureuri:false,
                fileElementId:'upfileId'+id,
                dataType: 'json',
                success: function (data, status) {
                    if(data.err=='0'){
                        mini.get("img_url"+id).setValue(data.msg);
                    }
                },
                error: function (data, status, e){
                    $("#picResult").html(e);
                }
            }
        )
        return false;
    }

    function CloseWindow(action) {
        if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
        else window.close();
    }
    function onCancel(e) {
        CloseWindow("cancel");
    }

    function onValidMobile(e){
        if (e.isValid) {
            if(!utils.isMobile(e.value)){
                e.errorText = "错误的手机号";
                e.isValid = false;
            }
        }
    }
    function onValidZip(e){
        if (e.isValid) {
            if(!utils.isZip(e.value)){
                e.errorText = "错误的邮编";
                e.isValid = false;
            }
        }
    }
    //验证身份证
    function onIDCardsValidation(e) {
        if (e.isValid) {
            var pattern = /\d*/;
            if (e.value.length < 15 || e.value.length > 18 || pattern.test(e.value) == false) {
                e.errorText = "必须输入18位数字";
                e.isValid = false;
            }
        }
    }
    function setReg(name,val){
        var deptCombo = mini.get(name+"_1_0");
        var positionCombo = mini.get(name+"_2_0");
        onDeptChanged(deptCombo,positionCombo,val);
    }

    // 获取地区数据
    function onDeptChanged(deptCombo,positionCombo,val) {
        var id = deptCombo.getValue();
        positionCombo.setValue("");
        var url = "/user/user/getRegion?pid=" + id
        positionCombo.setUrl(url);
    }



    //物流供应商去重
    function checkUnique(){
        var supplier_name = mini.get('supplier_name').getValue().trim();
        var urlstr = '/operator/supplier/supplierUnique';
        if(supplier_name=='') alert('供应商客户名称不能为空');
//        var urlstr = '/user/customer/curUnique';
        $.post(urlstr,{data:supplier_name},function(data){
            if(data.err=='0'){
                $("#chkMsg").text(data.msg);
            }else{
                alert(data.msg);
            }
        },'json');
    }
</script>
