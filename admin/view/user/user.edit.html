{layout file="public:mini_layout"}
<div style="width:690px; padding:5px;">
    <div class="mini-tabs" activeIndex="0" plain="false" class="form" id="basicForm">
      <div title="基本信息">
        <input class="mini-hidden" name="user_id" value="{$user.user_id}"/>
        <table width="100%" border="0" cellpadding="1" cellspacing="2">
          <tr>
            <td style="width:80px;">手机：</td>
            <td style="width:210px;">{$user.mobile}</td>
            <td colspan="2" rowspan="4" align="center" >{if $user.info.himg}<img src="__UPLOAD__/{$user.info.himg}" width="80">{else}-{/if}</td>
          </tr>
          <tr>
            <td>用户身份：</td>
            <td>{$utype.$user.info.utype}</td>
          </tr>
          <tr>
            <td>邮件：</td>
            <td>{$user.email}</td>
          </tr>
          <tr>
            <td>最后登录：</td>
            <td>{if $user.last_login gt 1000}{$user.last_login|date:Y-m-d H:i:s}{else}{/if}（{$user.visit_count}次）</td>
          </tr>
          <tr>
            <td >真实姓名：</td>
            <td>{if $user.info.chk_idcard eq '1'}{$user.info.real_name}{else}<input class="mini-textbox" name="real_name" value="{$user.info.real_name}" />{/if}</td>
            <td width="80">注册时间：</td>
            <td width="210">{$user.info.reg_time|date:Y-m-d H:i:s}@{$user.info.reg_ip}</td>
          </tr>
          <tr>
            <td >性别：</td>
            <td>{if $user.info.chk_idcard eq '1'}{if $user.info.sex eq '1'}男{elseif $user.info.sex eq '2'}女{/if}{else}<input class="mini-combobox" name="sex" style="width:50px;" data='[{"id":"1", "text": "男"},{"id":"2", "text": "女"}]' value="{$user.info.sex}"/>{/if}</td>
            <td>身份证：</td>
            <td><input class="mini-hidden" name="id_type" value="1"/>{if $user.info.chk_idcard eq '1'}{$user.info.id_card}{else}<input name="id_card" class="mini-textbox" value="{$user.info.id_card}" vtype="idcard" style="width:150px;" />{/if}</td>
          </tr>
          <tr>
            <td >出生日期：</td>
            <td>{if $user.info.chk_idcard eq '1'}{$user.info.birthday}{else}<input class="mini-datepicker" name="birthday" style="width:100px;" value=""/>{/if}</td>
            <td>邮箱认证：</td>
            <td>{if $user.info.chk_email}是{else}-{/if}</td>
          </tr>
          <tr>
            <td >银行认证：</td>
            <td>{if $user.info.chk_bank}是{else}-{/if}</td>
            <td>风险评估：</td>
            <td>{$chk_risk.$user.info.chk_risk}</td>
          </tr>
          <tr>
            <td>安全问题：</td>
            <td>{if $user.info.chk_safe}是{else}-{/if}</td>
            <td>用户来源：</td>
            <td>{$user_chanel.$user.chanel}</td>
          </tr>
          <tr>
            <td >推荐人：</td>
            <td>{if $user.info.ref_uid}{$user.info.ref_uid}{/if}</td>
            <td>注册来源：</td>
            <td>{$user.info.ref}</td>
          </tr>
  	  <tr>
            <td>最高学历</td>
            <td><input class="mini-combobox" name="education" data='{:setMiniConfig|$education}' textfield="name" valuefield="id" value="{$user.infoExt.education}"/>            </td>
            <td>入学年份</td>
            <td><input class="mini-combobox" name="entrance" data='{:setMiniConfig|$entrance}' textfield="name" valuefield="id" value="{$user.infoExt.entrance}"/>            </td>
          </tr>
  	  <tr>
            <td>毕业院校</td>
            <td><input class="mini-textbox" name="school"  id="school" value="{$user.infoExt.school}" /></td>
            <td>籍贯</td>
            <td><input class="mini-combobox" name="origin_province" id="origin_1_0" style="width:80px;" textField="name" valueField="id" onvaluechanged="setReg('origin')" data='{:setMiniConfig|$regionList}' value="{$user.infoExt.origin_province}" showNullItem="true"/>
              <input name="origin_city" id="origin_2_0" url="{if $user.infoExt.origin_province neq ''}/user/user/getRegion?pid={$user.infoExt.origin_province}{/if}" value="{$user.infoExt.origin_city}" class="mini-combobox" style="width:80px;" textField="name" valueField="id" />            </td>
          </tr>
  	  <tr>
            <td>户口所在地</td>
            <td><input name="domicile_place_province" id="place_1_0" style="width:80px;" class="mini-combobox" textField="name" valueField="id" onvaluechanged="setReg('place')" data='{:setMiniConfig|$regionList}' value="{$user.infoExt.domicile_place_province}" showNullItem="true"/>
              <input name="domicile_place_city" id="place_2_0" url="{if $user.infoExt.domicile_place_province neq ''}/user/user/getRegion?pid={$user.infoExt.domicile_place_province}{/if}" value="{$user.infoExt.domicile_place_city}" class="mini-combobox" style="width:80px;" textField="name" valueField="id" />            </td>
            <td>居住城市</td>
            <td><input name="province" id="c_1_0" style="width:80px;" class="mini-combobox" textField="name" valueField="id" onvaluechanged="setReg('c')" data='{:setMiniConfig|$regionList}' value="{$user.infoExt.province}" showNullItem="true"/>
              <input name="city" id="c_2_0" class="mini-combobox" url="{if $user.infoExt.province neq ''}/user/user/getRegion?pid={$user.infoExt.province}{/if}" value="{$user.infoExt.city}" style="width:80px;" textField="name" valueField="id" />
            </td>
          </tr>
  	  <tr>
            <td>居住地址</td>
            <td><input class="mini-textbox" name="address" style="border:1px solid #ccc" id="address" value="{$user.infoExt.address}" tipfor="errorMsg" tiperr="请填写居住地" /></td>
            <td>居住地邮编</td>
            <td><input class="mini-textbox" name="zip"  value="{$user.infoExt.zip}" tiperr="请填写居住地邮编" tipfor="errorMsg" /></td>
          </tr>
         
          <tr>
            <td>居住时长</td>
            <td>
              <input class="mini-combobox" name="lengthOfResidence" style="width:100px;" data='{:setMiniConfig|$live_long}' textfield="name" valuefield="id" value="{$user.infoExt.length_residence}"/>
            </td>
            <td>是否担保人：</td>
            <td><input name="is_security" class="mini-combobox" data='{:setMiniConfig|$is_security}' textfield="name" valuefield="id" value="{$user.info.is_security}"/></td>
          </tr>
        </table>
      </div>
      <div title="详细资料">
    		<div style="height:400px">
          <table width="100%">
            <caption><strong>个人简介</strong></caption>
            <tr>
              <td colspan="4"><input class="mini-textarea" style="width:100%;" name="bio" value="{$user.infoExt.bio}"/>
              </td>
            </tr>
          </table>
          <br />
    		<table width="100%">
          <caption><strong>工作信息</strong></caption>
            <tr>
              <td>职业状况：</td>
              <td><input class="mini-combobox" name="occupation" data='{:setMiniConfig|$occupation}' textfield="name" valuefield="id" value="{$user.infoExt.occupation}"/>
              </td>
              <td>单位名称：</td>
              <td><input class="mini-textbox" name="work_name" value="{$user.infoExt.work_name}" tiperr="请填写单位名称" tipfor="errorMsg"/></td>
            </tr>
            <tr>
              <td>职位：</td>
              <td><input class="mini-textbox" name="position" id="position" maxlength="18" value="{$user.infoExt.position}" /></td>
              <td><label>月平均收入：</label></td>
              <td><input class="mini-combobox" name="mLoanAmount" data='{:setMiniConfig|$mloan_amount}' textfield="name" valuefield="id" value="{$user.infoExt.mloan_amount}"/>
              </td>
            </tr>
            <tr>
              <td>工作邮箱：</td>
              <td><input name="work_email" class="mini-textbox" id="work_email" maxlength="18" value="{$user.infoExt.work_email}" tiprule="email" tiperr="请填写您的工作邮箱" tipfor="errorMsg" /></td>
              <td>工作城市：</td>
              <td><input name="work_city" class="mini-textbox" id="work_city" maxlength="18" value="{$user.infoExt.work_city}" tiperr="请填写您的工作城市" tipfor="errorMsg" /></td>
            </tr>
            <tr>
              <td>公司地址：</td>
              <td><input name="work_address" class="mini-textbox" id="work_address" maxlength="18" value="{$user.infoExt.work_address}" tiperr="请填写您的公司地址" tipfor="errorMsg" /></td>
              <td>公司类别：</td>
              <td><input class="mini-combobox" name="work_category" data='{:setMiniConfig|$company_category}' textfield="name" valuefield="id" value="{$user.infoExt.work_category}"/>
              </td>
            </tr>
            <tr>
              <td>公司行业：</td>
              <td><input class="mini-combobox" name="work_industry" data='{:setMiniConfig|$company_industry}' textfield="name" valuefield="id" value="{$user.infoExt.work_industry}"/>
              </td>
              <td>公司规模：</td>
              <td><input class="mini-combobox" name="work_scale" data='{:setMiniConfig|$company_scale}' textfield="name" valuefield="id" value="{$user.infoExt.work_scale}"/>
              </td>
            </tr>
            <tr>
              <td>在现单位工作年限：</td>
              <td><input class="mini-combobox" name="work_years" data='{:setMiniConfig|$work_years}' textfield="name" valuefield="id" value="{$user.infoExt.work_years}"/>
              </td>
              <td>公司电话：</td>
              <td><input name="work_phone" class="mini-textbox" id="work_phone" maxlength="18" value="{$user.infoExt.work_phone}" tiprule="phone" tiperr="请填写您的公司电话" tipfor="errorMsg" /></td>
            </tr>
          </table>
          <br />
          <table width="100%">
            <caption><strong>家庭信息</strong></caption>
            <tr>
              <td>婚姻状况：</td>
              <td><div class="mini-radiobuttonlist" name="marital" id="marital" repeatItems="1" repeatLayout="table" repeatDirection="vertical" textField="name" valueField="id" value="{$user.infoExt.marital}" data='{:setMiniConfig|$marital}'></div></td>
              <td>有无子女：</td>
              <td><div class="mini-radiobuttonlist" name="children" id="children" repeatItems="1" repeatLayout="table" repeatDirection="vertical" textField="name" valueField="id" value="{$user.infoExt.marital}" data='{:setMiniConfig|$children}'></div></td>
            </tr>
            <tr>
              <td colspan="4"><strong>直属亲戚</strong></td>
            </tr>
            <tr>
              <td>姓名：</td>
              <td><input name="immediate_name" class="mini-textbox" id="immediate_name" maxlength="18" value="{$user.infoExt.immediate_name}"/></td>
              <td>关系：</td>
              <td><input name="immediate_relation" class="mini-textbox" id="immediate_relation" maxlength="18" value="{$user.infoExt.immediate_relation}"/></td>
            </tr>
            <tr>
              <td>手机：</td>
              <td><input name="immediate_mobile" class="mini-textbox" id="immediate_mobile" maxlength="18" value="{$user.infoExt.immediate_mobile}" vtype="mobile" onvalidation="onValidMobile" /></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
            <tr>
              <td colspan="4"><strong>其他联系人</strong></td>
            </tr>
            <tr>
              <td>姓名：</td>
              <td><input name="other_name" class="mini-textbox" id="other_name" maxlength="18" value="{$user.infoExt.other_name}"/></td>
              <td>关系：</td>
              <td><input name="other_relation" class="mini-textbox" id="other_relation" maxlength="18" value="{$user.infoExt.other_relation}"/></td>
            </tr>
            <tr>
              <td>手机：</td>
              <td><input name="other_mobile" class="mini-textbox" id="other_mobile" maxlength="11" value="{$user.infoExt.other_mobile}" vtype="mobile" onvalidation="onValidMobile" /></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
          </table>
          <br />
          <table width="100%">
            <caption><strong>贷款情况</strong></caption>
            <tr>
              <td>房贷情况：</td>
              <td><input class="mini-combobox" name="houseLoan" id="houseLoan" data='{:setMiniConfig|$mortgage_situation}' textfield="name" valuefield="id" value="{$user.infoExt.house_loan}"/>
              </td>
              <td><span style="display:">平均每月还款额：</span></td>
              <td><span style="display:">
                <input class="mini-textbox" value="{$user.infoExt.repay_loanamount}" name="repayLoanAmount" id="repayLoanAmount" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />
                </span></td>
            </tr>
            <tr>
              <td>车贷情况：</td>
              <td><input class="mini-combobox" name="carLoan" id="carLoan" data='{:setMiniConfig|$truck_situation}' textfield="name" valuefield="id" value="{$user.infoExt.car_loan}"/>
              </td>
              <td><span style="display:">每月车贷还款金额：</span></td>
              <td><span style="display:">
                <input class="mini-textbox" value="{$user.infoExt.car_loanamount}" name="carLoanAmount" id="carLoanAmount" />
                </span></td>
            </tr>
          </table>
    		</div>
      </div>
      <div title="认证信息">
        <div style="height:400px">
  	     {insert_css files="loan.css,borrow_pop.css"}
          <table width="100%">
            <tr>
              <td>必要上传资料</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
            <tr>
              <td colspan="4">
              <ul class="ver-bg-icon-ul J_verify_Status_ul" style="margin-left:0;height:auto;">
              <li><span>身份认证</span>
                <div data="0" class="ver-bg-icon shenfen-disable {if $userAtt.1}{if $userAtt.1.status eq '2'}icon-decli{elseif $userAtt.1.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                {if !$userAtt.1 || $userAtt.1.status neq '1'}<a tabindex="-1" class="auth" href="javascript:showHolder(1)">补充上传</a> {/if}</li>
              <li><span>工作认证</span>
                <div data="1" class="ver-bg-icon gongzuo-disable {if $userAtt.2}{if $userAtt.2.status eq '2'}icon-decli{elseif $userAtt.2.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(2)">补充上传</a> </li>
              <li><span>信用认证</span>
                <div data="1" class="ver-bg-icon xinyong-disable {if $userAtt.3}{if $userAtt.3.status eq '2'}icon-decli{elseif $userAtt.3.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(3)">补充上传</a> </li>
              <li><span>收入认证</span>
                <div data="1" class="ver-bg-icon shouru-disable {if $userAtt.4}{if $userAtt.4.status eq '2'}icon-decli{elseif $userAtt.4.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(4)">补充上传</a> </li>
            </ul></td>
              </tr>
            <tr>
              <td>可选上传资料</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
            <tr>
              <td colspan="4">
              <ul class="ver-bg-icon-ul" style="margin-left:0; height:auto;">
              <li><span>房产认证</span>
                <div class="ver-bg-icon fangchan-disable {if $userAtt.5}{if $userAtt.5.status eq '2'}icon-decli{elseif $userAtt.5.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(5)">上传资料</a> </li>
              <li><span>购车认证</span>
                <div class="ver-bg-icon gouche-disable {if $userAtt.6}{if $userAtt.6.status eq '2'}icon-decli{elseif $userAtt.6.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(6)">上传资料</a> </li>
              <li><span>结婚认证</span>
                <div class="ver-bg-icon jiehun-disable {if $userAtt.7}{if $userAtt.7.status eq '2'}icon-decli{elseif $userAtt.7.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(7)">上传资料</a> </li>
              <li><span>学历认证</span>
                <div class="ver-bg-icon xueli-disable {if $userAtt.8}{if $userAtt.8.status eq '2'}icon-decli{elseif $userAtt.8.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(8)">上传资料</a> </li>
              
            </ul></td>
              </tr>
              <tr>
              <td colspan="4">
              <ul class="ver-bg-icon-ul" style="margin-left:0; height:auto;">
              <li> <span>职称认证</span>
                <div class="ver-bg-icon jishu-disable {if $userAtt.9}{if $userAtt.9.status eq '2'}icon-decli{elseif $userAtt.9.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(9)">上传资料</a> </li>
              <li><span>手机认证</span>
                <div class="ver-bg-icon shouji-disable {if $userAtt.10}{if $userAtt.10.status eq '2'}icon-decli{elseif $userAtt.10.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(10)">补充上传</a> </li>
              <li><span>微博认证</span>
                <div class="ver-bg-icon weibo-disable {if $userAtt.11}{if $userAtt.11.status eq '2'}icon-decli{elseif $userAtt.11.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(11)">上传资料</a> </li>
              <li><span>居住认证</span>
                <div class="ver-bg-icon juzhu-disable {if $userAtt.12}{if $userAtt.12.status eq '2'}icon-decli{elseif $userAtt.12.status eq '1'}icon-pass{else}icon-alload{/if}{else}icon-noload{/if}"> <em></em> </div>
                <a tabindex="-1" class="auth" href="javascript:showHolder(12)">上传资料</a> </li>
            </ul></td>
              </tr>
            <tr>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
          </table> 
  	    </div>
      </div>
      {if $user.info.utype eq 3}
      <div title="企业资料">
          <table width="100%">
            <tr>
              <td>公司名称：</td>
              <td><input name="company_name" class="mini-textbox" style="width:250px;" required="true" value="{$user.infoExt.company_name}"/></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
            <tr>
              <td>公司类别：</td>
              <td><input class="mini-combobox" style="width:250px;" name="company_category" data='{:setMiniConfig|$company_category}' required="true" textfield="name" valuefield="id" value="{$user.infoExt.company_category}"/>
              </td>
              <td>公司行业：</td>
              <td><input class="mini-combobox" name="company_industry" data='{:setMiniConfig|$company_industry}' required="true" textfield="name" valuefield="id" value="{$user.infoExt.company_industry}"/>
              </td>
            </tr>
            <tr>
              <td>公司规模：</td>
              <td><input class="mini-combobox" name="company_scale" data='{:setMiniConfig|$company_scale}' required="true" textfield="name" valuefield="id" value="{$user.infoExt.company_scale}"/>
              </td>
              <td>月销售收入：</td>
              <td>
                <input name="company_revenue" class="mini-textbox" style="width:100px;" required="true" onvalidation="onValidFullMoney" value="{$user.infoExt.company_revenue|default:}"/>
              万
              </td>
            </tr>
            <tr>
              <td>经营场所：</td>
              <td><input class="mini-combobox" name="company_palce" data='{:setMiniConfig|$company_palce}' required="true" textfield="name" valuefield="id" value="{$user.infoExt.company_palce}"/>
              </td>
              <td>经营年限：</td>
              <td>
                <input name="company_period" class="mini-textbox" style="width:100px;" required="true" onvalidation="onValidFullMoney" value="{$user.infoExt.company_period|default:}"/>
              年
              </td>
            </tr>
            <tr>
              <td>所在省市</td>
              <td><input name="company_province" id="c_1_0" style="width:80px;" required="true" class="mini-combobox" textField="name" valueField="id" onvaluechanged="setReg('c')" data='{:setMiniConfig|$regionList}' value="{$user.infoExt.company_province}" showNullItem="true"/>
                <input name="company_city" id="c_2_0" required="true" class="mini-combobox" url="{if $user.infoExt.company_province}/user/user/getRegion?pid={$user.infoExt.company_province}{/if}" value="{$user.infoExt.company_city}" style="width:80px;" textField="name" valueField="id" />
              </td>
            </tr>          
            <tr>
              <td>公司地址：</td>
              <td><input name="company_address" class="mini-textbox" style="width:250px;" required="true" value="{$user.infoExt.company_address}"/></td>
              <td></td>
              <td></td>
            </tr>
          </table>
          <table width="100%">
          <caption><strong>企业资质</strong></caption>
          {foreach from=range(30,36) item=i}
            <tr>
              <td>{$user_verify.$i}：</td>
              <td>
                <input id="upfileId{$i}" type="file" name="upFile" onchange="fileUpload({$i});" />
                {if $a=$userAtt.$i}<a target="_blank" href="__UPLOAD__/{$a.file_url}">查看</a> 认证时间:{$a.access_time|date:Y-m-d H:i:s}{/if}
                <input id="img_url{$i}" name="user_att_{$i}" class="mini-hidden" value="{$a.id}" />
              </td>
            </tr>
           {/foreach}
          </table>
      </div>
      {elseif $user.info.utype eq 2}
      <div title="经纪人资料">
          <table width="100%">
          <tr>
            <td>机构名称：</td>
            <td><input name="agent_name" class="mini-textbox" value="{$user.infoExt.agent.name}" style="width:150px;" required="true"/></td>
            <td>机构类型：</td>
            <td><input name="agent_ecotype" class="mini-combobox" data='{:setMiniConfig|$eco_type}' style="width:150px;" required="true" textfield="name" valuefield="id" value="{$user.infoExt.agent.ecotype}"/></td>
          </tr>
          <tr>
            <td>联系人：</td>
            <td><input name="agent_contacts" class="mini-textbox" value="{$user.infoExt.agent.contacts}" style="width:150px;" required="true"/></td>
            <td>联系人电话：</td>
            <td><input name="agent_phone" class="mini-textbox" value="{$user.infoExt.agent.phone}" style="width:150px;" required="true" vtype="tel"/></td>
          </tr>
          <tr>
            <td>地址：</td>
            <td><input name="agent_address" class="mini-textbox" value="{$user.infoExt.agent.address}" style="width:150px;" required="true"/></td>
            <td>邮编：</td>
            <td><input name="agent_zip" class="mini-textbox" value="{$user.infoExt.agent.zip}" style="width:150px;" maxlength="6" vtype="zip"/></td>
          </tr>
          <tr>
            <td>客服经理代码：</td>
            <td><input class="mini-textbox" name="agent_customer_code" value="{$user.infoExt.agent.customer_code}" style="width:150px;"/></td>
          </tr>
        </table>
      </div>
      {/if}
    </div>
    <div align="center" style="margin-top:10px;">
      <a class="mini-button" iconCls="icon-ok" onclick="submitBasic();">确定</a>
      <a class="mini-button" iconCls="icon-cancel" onclick="onCancel">关闭</a>
      <span id="returnMsg" style="padding-left:5px; color:#F00;"></span>
    </div>

</div>

<script src="__JS__/jquery/jquery.upload.js" type="text/javascript"></script>
<script type="text/javascript">
mini.parse();
function setReg(name,val){
	var deptCombo = mini.get(name+"_1_0");
	var positionCombo = mini.get(name+"_2_0");

	onDeptChanged(deptCombo,positionCombo,val);
}
function onDeptChanged(deptCombo,positionCombo,val) {
	var id = deptCombo.getValue();
	positionCombo.setValue("");
	var url = "/user/user/getRegion?pid=" + id
	positionCombo.setUrl(url);
}

function fileUpload(cType) {
  $.ajaxFileUpload({
    url:'/system/sysUpload/upload?model={$action}',
      secureuri:false,
      fileElementId:'upfileId'+cType,
      dataType: 'json',
      success: function (data, status) {
        if(data.error=='0'){
          mini.get("img_url"+cType).setValue(data.attId);
          var $ipt = $('#upfileId'+cType);
          if($ipt.next("a").size()){
            $ipt.next("a").prop("href",'__UPLOAD__/'+data.url);
          }else{
            $ipt.after(' <a target="_blank" href="__UPLOAD__/'+data.url+'">查看</a>');
          }
        }else{
          alert(data.msg);
        }
      },
      error: function (data, status, e){
        alert(e);
      }
    }
  )
  return false;
}

function showHolder(ctype){
	var url='/user/user/showHolder?ctype='+ctype+'&user_id={$user.user_id}';
	mini.open({
		url: url,
		showMaxButton:true,
		title: "补充用户认证", width: 850, height:550
	});
}

function submitBasic(){
  var form = new mini.Form("#basicForm");
  form.validate();
  if(form.isValid() == false) return;
  //提交数据
  var o = form.getData();
  var json = mini.encode(o);
  $("#returnMsg").text('');
  form.loading("数据提交中，请稍后......");
  $.post('/user/user/editSubmit',{data:json},function(data){
	  form.unmask();
	  $("#returnMsg").text(data.msg);
	  if(data.err=='0'){
		  CloseWindow("save");
	  }else{
		  return false;
	  }
  },'json');
}

function CloseWindow(action) {            
	if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
	else window.close();            
}
function onCancel(e) {
	CloseWindow("cancel");
}
function onValidMobile(e){
   if (e.isValid) {
	   if(e.value && !utils.isMobile(e.value)){
		   e.errorText = "错误的手机号";
		    e.isValid = false;
	   }
   }
}
</script>